<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Storage Engine API: mongo::DeferredWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link href="mongodb.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="mongodb-logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Storage Engine API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classmongo_1_1DeferredWriter.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classmongo_1_1DeferredWriter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mongo::DeferredWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides an interface for asynchronously adding to a collection.  
 <a href="classmongo_1_1DeferredWriter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="deferred__writer_8h_source.html">deferred_writer.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides an interface for asynchronously adding to a collection. </p>
<p>Allows writes to a collection in a context without appropriate locks by buffering them in memory and asynchronously writing them to the backing collection. Useful when an operation with e.g. a global MODE_S lock needs to write, but doesn't care that the write shows up immediately. Motivated by the local health log. For obvious reasons, cannot provide strong durability guarantees, and cannot report whether the insert succeeded&ndash;in other words, this class provides eventual "best effort" inserts.</p>
<p>Because this class is motivated by the health log and errors cannot be cleanly reported to the caller, it cannot report most errors to the client; it instead periodically logs any errors to the system log.</p>
<p>Instances of this class are unconditionally thread-safe, and cannot cause deadlock barring improper use of the ctor, <code>flush</code> and <code>shutdown</code> methods below. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abec519dda959b2dd4e0cbb6d9a99582b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#abec519dda959b2dd4e0cbb6d9a99582b">DeferredWriter</a> (NamespaceString nss, <a class="el" href="structmongo_1_1CollectionOptions.html">CollectionOptions</a> opts, int64_t maxSize)</td></tr>
<tr class="memdesc:abec519dda959b2dd4e0cbb6d9a99582b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new <a class="el" href="classmongo_1_1DeferredWriter.html" title="Provides an interface for asynchronously adding to a collection. ">DeferredWriter</a> for writing to a given collection.  <a href="#abec519dda959b2dd4e0cbb6d9a99582b">More...</a><br /></td></tr>
<tr class="separator:abec519dda959b2dd4e0cbb6d9a99582b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdbe2a9cfe6c879f17a2298c3709cc4d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#acdbe2a9cfe6c879f17a2298c3709cc4d">startup</a> (std::string workerName)</td></tr>
<tr class="memdesc:acdbe2a9cfe6c879f17a2298c3709cc4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the background worker thread writing to the given collection.  <a href="#acdbe2a9cfe6c879f17a2298c3709cc4d">More...</a><br /></td></tr>
<tr class="separator:acdbe2a9cfe6c879f17a2298c3709cc4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaecba4752689add25a33d3391cb4e52c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#aaecba4752689add25a33d3391cb4e52c">shutdown</a> (<a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>)</td></tr>
<tr class="memdesc:aaecba4752689add25a33d3391cb4e52c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush the buffer and <code>join</code> the worker thread.  <a href="#aaecba4752689add25a33d3391cb4e52c">More...</a><br /></td></tr>
<tr class="separator:aaecba4752689add25a33d3391cb4e52c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a81f596ea2a059fc95e3b1be14ef8a3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a2a81f596ea2a059fc95e3b1be14ef8a3">~DeferredWriter</a> ()</td></tr>
<tr class="memdesc:a2a81f596ea2a059fc95e3b1be14ef8a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleans up the writer.  <a href="#a2a81f596ea2a059fc95e3b1be14ef8a3">More...</a><br /></td></tr>
<tr class="separator:a2a81f596ea2a059fc95e3b1be14ef8a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a359fd8a507b0f1a624f744a9ece98f45"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a359fd8a507b0f1a624f744a9ece98f45">insertDocument</a> (BSONObj obj)</td></tr>
<tr class="memdesc:a359fd8a507b0f1a624f744a9ece98f45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deferred-insert the given object.  <a href="#a359fd8a507b0f1a624f744a9ece98f45">More...</a><br /></td></tr>
<tr class="separator:a359fd8a507b0f1a624f744a9ece98f45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac31d6ae481cb66e9eee9a25715b67e2f"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#ac31d6ae481cb66e9eee9a25715b67e2f">getDroppedEntries</a> ()</td></tr>
<tr class="memdesc:ac31d6ae481cb66e9eee9a25715b67e2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the number of dropped writes due to a full buffer since the last log.  <a href="#ac31d6ae481cb66e9eee9a25715b67e2f">More...</a><br /></td></tr>
<tr class="separator:ac31d6ae481cb66e9eee9a25715b67e2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a71abc670cd0eb6172c78672b292d0a15"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">TimePoint</a> = stdx::chrono::time_point&lt; stdx::chrono::system_clock &gt;</td></tr>
<tr class="memdesc:a71abc670cd0eb6172c78672b292d0a15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time we last logged that we can't write to the underlying collection.  <a href="#a71abc670cd0eb6172c78672b292d0a15">More...</a><br /></td></tr>
<tr class="separator:a71abc670cd0eb6172c78672b292d0a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a93e4e8da9c3687cd8156f48a919e374c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a93e4e8da9c3687cd8156f48a919e374c">MONGO_DISALLOW_COPYING</a> (<a class="el" href="classmongo_1_1DeferredWriter.html">DeferredWriter</a>)</td></tr>
<tr class="separator:a93e4e8da9c3687cd8156f48a919e374c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b232e6a83d19390f131ce0342271e9b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a8b232e6a83d19390f131ce0342271e9b">_logFailure</a> (const <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a> &amp;<a class="el" href="namespacemongo.html#a82fa4e2e71623255142cdcc5c399d7b2">status</a>)</td></tr>
<tr class="memdesc:a8b232e6a83d19390f131ce0342271e9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log failure, but only if a certain interval has passed since the last log.  <a href="#a8b232e6a83d19390f131ce0342271e9b">More...</a><br /></td></tr>
<tr class="separator:a8b232e6a83d19390f131ce0342271e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ad946001904a84f91547226892c0326"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a5ad946001904a84f91547226892c0326">_logDroppedEntry</a> ()</td></tr>
<tr class="memdesc:a5ad946001904a84f91547226892c0326"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log number of entries dropped because of a full buffer.  <a href="#a5ad946001904a84f91547226892c0326">More...</a><br /></td></tr>
<tr class="separator:a5ad946001904a84f91547226892c0326"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9a2236beb60438c3e9b16c2b0e10201"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#ae9a2236beb60438c3e9b16c2b0e10201">_makeCollection</a> (OperationContext *<a class="el" href="namespacemongo.html#a15b23ef1d9a7f6cdadbf866f1e8e5043">opCtx</a>)</td></tr>
<tr class="memdesc:ae9a2236beb60438c3e9b16c2b0e10201"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the backing collection if it doesn't exist.  <a href="#ae9a2236beb60438c3e9b16c2b0e10201">More...</a><br /></td></tr>
<tr class="separator:ae9a2236beb60438c3e9b16c2b0e10201"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09f9517e0c04fc1f5554daf191da7f9b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmongo_1_1StatusWith.html">StatusWith</a>&lt; std::unique_ptr&lt; AutoGetCollection &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a09f9517e0c04fc1f5554daf191da7f9b">_getCollection</a> (OperationContext *<a class="el" href="namespacemongo.html#a15b23ef1d9a7f6cdadbf866f1e8e5043">opCtx</a>)</td></tr>
<tr class="memdesc:a09f9517e0c04fc1f5554daf191da7f9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensure that the backing collection exists, and pass back a lock and handle to it.  <a href="#a09f9517e0c04fc1f5554daf191da7f9b">More...</a><br /></td></tr>
<tr class="separator:a09f9517e0c04fc1f5554daf191da7f9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5693896e6659422ecb5c0f3ebe2fa6e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a5693896e6659422ecb5c0f3ebe2fa6e4">_worker</a> (InsertStatement stmt)</td></tr>
<tr class="memdesc:a5693896e6659422ecb5c0f3ebe2fa6e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The method that the worker thread will run.  <a href="#a5693896e6659422ecb5c0f3ebe2fa6e4">More...</a><br /></td></tr>
<tr class="separator:a5693896e6659422ecb5c0f3ebe2fa6e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:af3d623655e594949def96ae1f0908024"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structmongo_1_1CollectionOptions.html">CollectionOptions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#af3d623655e594949def96ae1f0908024">_collectionOptions</a></td></tr>
<tr class="memdesc:af3d623655e594949def96ae1f0908024"><td class="mdescLeft">&#160;</td><td class="mdescRight">The options for the collection, in case we need to create it.  <a href="#af3d623655e594949def96ae1f0908024">More...</a><br /></td></tr>
<tr class="separator:af3d623655e594949def96ae1f0908024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf31c1eb46925cc1c4bb184f4fc76516"><td class="memItemLeft" align="right" valign="top">const int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#acf31c1eb46925cc1c4bb184f4fc76516">_maxNumBytes</a></td></tr>
<tr class="memdesc:acf31c1eb46925cc1c4bb184f4fc76516"><td class="mdescLeft">&#160;</td><td class="mdescRight">The size limit of the in-memory buffer.  <a href="#acf31c1eb46925cc1c4bb184f4fc76516">More...</a><br /></td></tr>
<tr class="separator:acf31c1eb46925cc1c4bb184f4fc76516"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bb55fa85c42ecf910d726c7322e5eae"><td class="memItemLeft" align="right" valign="top">const NamespaceString&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a7bb55fa85c42ecf910d726c7322e5eae">_nss</a></td></tr>
<tr class="memdesc:a7bb55fa85c42ecf910d726c7322e5eae"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the backing collection.  <a href="#a7bb55fa85c42ecf910d726c7322e5eae">More...</a><br /></td></tr>
<tr class="separator:a7bb55fa85c42ecf910d726c7322e5eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a046f1891e5c87da1a5fd43ad54a81f83"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; ThreadPool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a046f1891e5c87da1a5fd43ad54a81f83">_pool</a></td></tr>
<tr class="separator:a046f1891e5c87da1a5fd43ad54a81f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace65942b8f691b1455238a3d554de1c9"><td class="memItemLeft" align="right" valign="top">stdx::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#ace65942b8f691b1455238a3d554de1c9">_mutex</a></td></tr>
<tr class="memdesc:ace65942b8f691b1455238a3d554de1c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Guards all non-const, non-thread-safe members.  <a href="#ace65942b8f691b1455238a3d554de1c9">More...</a><br /></td></tr>
<tr class="separator:ace65942b8f691b1455238a3d554de1c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21fa3c335fdca159ad5839ea5ddb1535"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a21fa3c335fdca159ad5839ea5ddb1535">_numBytes</a></td></tr>
<tr class="memdesc:a21fa3c335fdca159ad5839ea5ddb1535"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of bytes currently in the in-memory buffer.  <a href="#a21fa3c335fdca159ad5839ea5ddb1535">More...</a><br /></td></tr>
<tr class="separator:a21fa3c335fdca159ad5839ea5ddb1535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76aee4ddfda4d0d030d5c423b13fb92f"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a76aee4ddfda4d0d030d5c423b13fb92f">_droppedEntries</a></td></tr>
<tr class="memdesc:a76aee4ddfda4d0d030d5c423b13fb92f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of deffered entries that have been dropped.  <a href="#a76aee4ddfda4d0d030d5c423b13fb92f">More...</a><br /></td></tr>
<tr class="separator:a76aee4ddfda4d0d030d5c423b13fb92f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a114c4cf60b77dfeecf9ba068724e0451"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">TimePoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a114c4cf60b77dfeecf9ba068724e0451">_lastLogged</a></td></tr>
<tr class="separator:a114c4cf60b77dfeecf9ba068724e0451"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a910761d3937061bfe6974587b1c57c77"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">TimePoint</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1DeferredWriter.html#a910761d3937061bfe6974587b1c57c77">_lastLoggedDrop</a></td></tr>
<tr class="separator:a910761d3937061bfe6974587b1c57c77"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a71abc670cd0eb6172c78672b292d0a15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71abc670cd0eb6172c78672b292d0a15">&#9670;&nbsp;</a></span>TimePoint</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">mongo::DeferredWriter::TimePoint</a> =  stdx::chrono::time_point&lt;stdx::chrono::system_clock&gt;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Time we last logged that we can't write to the underlying collection. </p>
<p>Ensures we don't flood the log with such entries. </p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abec519dda959b2dd4e0cbb6d9a99582b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abec519dda959b2dd4e0cbb6d9a99582b">&#9670;&nbsp;</a></span>DeferredWriter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mongo::DeferredWriter::DeferredWriter </td>
          <td>(</td>
          <td class="paramtype">NamespaceString&#160;</td>
          <td class="paramname"><em>nss</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmongo_1_1CollectionOptions.html">CollectionOptions</a>&#160;</td>
          <td class="paramname"><em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>maxSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new <a class="el" href="classmongo_1_1DeferredWriter.html" title="Provides an interface for asynchronously adding to a collection. ">DeferredWriter</a> for writing to a given collection. </p>
<p>Will not begin writing to the backing collection until <code>startup</code> is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">opts</td><td>The options to use when creating the backing collection if it doesn't exist. </td></tr>
    <tr><td class="paramname">maxSize</td><td>the maximum number of bytes to store in the buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2a81f596ea2a059fc95e3b1be14ef8a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a81f596ea2a059fc95e3b1be14ef8a3">&#9670;&nbsp;</a></span>~DeferredWriter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mongo::DeferredWriter::~DeferredWriter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleans up the writer. </p>
<p>Does not clean up the worker thread; call <code>shutdown</code> for that. Instead, if the worker thread is still running calls std::terminate, which crashes the server. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a09f9517e0c04fc1f5554daf191da7f9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09f9517e0c04fc1f5554daf191da7f9b">&#9670;&nbsp;</a></span>_getCollection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmongo_1_1StatusWith.html">StatusWith</a>&lt; std::unique_ptr&lt; AutoGetCollection &gt; &gt; mongo::DeferredWriter::_getCollection </td>
          <td>(</td>
          <td class="paramtype">OperationContext *&#160;</td>
          <td class="paramname"><em>opCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ensure that the backing collection exists, and pass back a lock and handle to it. </p>

</div>
</div>
<a id="a5ad946001904a84f91547226892c0326"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ad946001904a84f91547226892c0326">&#9670;&nbsp;</a></span>_logDroppedEntry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::DeferredWriter::_logDroppedEntry </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Log number of entries dropped because of a full buffer. </p>
<p>Rate limited and each successful log resets the counter. </p>

</div>
</div>
<a id="a8b232e6a83d19390f131ce0342271e9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b232e6a83d19390f131ce0342271e9b">&#9670;&nbsp;</a></span>_logFailure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::DeferredWriter::_logFailure </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a> &amp;&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Log failure, but only if a certain interval has passed since the last log. </p>

</div>
</div>
<a id="ae9a2236beb60438c3e9b16c2b0e10201"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9a2236beb60438c3e9b16c2b0e10201">&#9670;&nbsp;</a></span>_makeCollection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a> mongo::DeferredWriter::_makeCollection </td>
          <td>(</td>
          <td class="paramtype">OperationContext *&#160;</td>
          <td class="paramname"><em>opCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create the backing collection if it doesn't exist. </p>
<p>Return whether creation succeeded. </p>

</div>
</div>
<a id="a5693896e6659422ecb5c0f3ebe2fa6e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5693896e6659422ecb5c0f3ebe2fa6e4">&#9670;&nbsp;</a></span>_worker()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::DeferredWriter::_worker </td>
          <td>(</td>
          <td class="paramtype">InsertStatement&#160;</td>
          <td class="paramname"><em>stmt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The method that the worker thread will run. </p>

</div>
</div>
<a id="ac31d6ae481cb66e9eee9a25715b67e2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac31d6ae481cb66e9eee9a25715b67e2f">&#9670;&nbsp;</a></span>getDroppedEntries()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t mongo::DeferredWriter::getDroppedEntries </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the number of dropped writes due to a full buffer since the last log. </p>

</div>
</div>
<a id="a359fd8a507b0f1a624f744a9ece98f45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a359fd8a507b0f1a624f744a9ece98f45">&#9670;&nbsp;</a></span>insertDocument()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool mongo::DeferredWriter::insertDocument </td>
          <td>(</td>
          <td class="paramtype">BSONObj&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deferred-insert the given object. </p>
<p>Returns whether the object was successfully pushed onto the in-memory buffer (<em>not</em> whether it was successfully added to the underlying collection). Creates the backing collection if it doesn't exist. </p>

</div>
</div>
<a id="a93e4e8da9c3687cd8156f48a919e374c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e4e8da9c3687cd8156f48a919e374c">&#9670;&nbsp;</a></span>MONGO_DISALLOW_COPYING()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">mongo::DeferredWriter::MONGO_DISALLOW_COPYING </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmongo_1_1DeferredWriter.html">DeferredWriter</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aaecba4752689add25a33d3391cb4e52c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaecba4752689add25a33d3391cb4e52c">&#9670;&nbsp;</a></span>shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::DeferredWriter::shutdown </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush the buffer and <code>join</code> the worker thread. </p>
<p>IMPORTANT: Must be called before destruction if <code>startup</code> has been called.</p>
<p>Blocks until buffered writes complete. Must not be called repeatedly. </p>

</div>
</div>
<a id="acdbe2a9cfe6c879f17a2298c3709cc4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdbe2a9cfe6c879f17a2298c3709cc4d">&#9670;&nbsp;</a></span>startup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::DeferredWriter::startup </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>workerName</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start the background worker thread writing to the given collection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">workerName</td><td>The name of the client associated with the worker thread. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="af3d623655e594949def96ae1f0908024"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3d623655e594949def96ae1f0908024">&#9670;&nbsp;</a></span>_collectionOptions</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structmongo_1_1CollectionOptions.html">CollectionOptions</a> mongo::DeferredWriter::_collectionOptions</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The options for the collection, in case we need to create it. </p>

</div>
</div>
<a id="a76aee4ddfda4d0d030d5c423b13fb92f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76aee4ddfda4d0d030d5c423b13fb92f">&#9670;&nbsp;</a></span>_droppedEntries</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t mongo::DeferredWriter::_droppedEntries</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The number of deffered entries that have been dropped. </p>
<p>Resets when the rate-limited system log is written out. </p>

</div>
</div>
<a id="a114c4cf60b77dfeecf9ba068724e0451"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a114c4cf60b77dfeecf9ba068724e0451">&#9670;&nbsp;</a></span>_lastLogged</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">TimePoint</a> mongo::DeferredWriter::_lastLogged</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a910761d3937061bfe6974587b1c57c77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a910761d3937061bfe6974587b1c57c77">&#9670;&nbsp;</a></span>_lastLoggedDrop</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmongo_1_1DeferredWriter.html#a71abc670cd0eb6172c78672b292d0a15">TimePoint</a> mongo::DeferredWriter::_lastLoggedDrop</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="acf31c1eb46925cc1c4bb184f4fc76516"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf31c1eb46925cc1c4bb184f4fc76516">&#9670;&nbsp;</a></span>_maxNumBytes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int64_t mongo::DeferredWriter::_maxNumBytes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The size limit of the in-memory buffer. </p>

</div>
</div>
<a id="ace65942b8f691b1455238a3d554de1c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace65942b8f691b1455238a3d554de1c9">&#9670;&nbsp;</a></span>_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">stdx::mutex mongo::DeferredWriter::_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Guards all non-const, non-thread-safe members. </p>

</div>
</div>
<a id="a7bb55fa85c42ecf910d726c7322e5eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bb55fa85c42ecf910d726c7322e5eae">&#9670;&nbsp;</a></span>_nss</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const NamespaceString mongo::DeferredWriter::_nss</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The name of the backing collection. </p>

</div>
</div>
<a id="a21fa3c335fdca159ad5839ea5ddb1535"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21fa3c335fdca159ad5839ea5ddb1535">&#9670;&nbsp;</a></span>_numBytes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int64_t mongo::DeferredWriter::_numBytes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The number of bytes currently in the in-memory buffer. </p>

</div>
</div>
<a id="a046f1891e5c87da1a5fd43ad54a81f83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a046f1891e5c87da1a5fd43ad54a81f83">&#9670;&nbsp;</a></span>_pool</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;ThreadPool&gt; mongo::DeferredWriter::_pool</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/louis/git/mongodbsource.github.io/src/src/mongo/db/concurrency/<a class="el" href="deferred__writer_8h_source.html">deferred_writer.h</a></li>
<li>/home/louis/git/mongodbsource.github.io/src/src/mongo/db/concurrency/<a class="el" href="deferred__writer_8cpp.html">deferred_writer.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemongo.html">mongo</a></li><li class="navelem"><a class="el" href="classmongo_1_1DeferredWriter.html">DeferredWriter</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
