<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Storage Engine API: mongo::RecoveryUnit Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link href="mongodb.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="mongodb-logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Storage Engine API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classmongo_1_1RecoveryUnit.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="classmongo_1_1RecoveryUnit-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mongo::RecoveryUnit Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p>A <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> is responsible for ensuring that data is persisted.  
 <a href="classmongo_1_1RecoveryUnit.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="recovery__unit_8h_source.html">recovery_unit.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for mongo::RecoveryUnit:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classmongo_1_1RecoveryUnit.png" usemap="#mongo::RecoveryUnit_map" alt=""/>
  <map id="mongo::RecoveryUnit_map" name="mongo::RecoveryUnit_map">
<area href="classmongo_1_1DurRecoveryUnit.html" title="Just pass through to getDur(). " alt="mongo::DurRecoveryUnit" shape="rect" coords="0,56,262,80"/>
<area href="classmongo_1_1EphemeralForTestRecoveryUnit.html" alt="mongo::EphemeralForTestRecoveryUnit" shape="rect" coords="272,56,534,80"/>
<area href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html" title="A RecoveryUnit for HeapRecordStoreBtree, this is for testing btree only. " alt="mongo::HeapRecordStoreBtreeRecoveryUnit" shape="rect" coords="544,56,806,80"/>
<area href="classmongo_1_1MobileRecoveryUnit.html" alt="mongo::MobileRecoveryUnit" shape="rect" coords="816,56,1078,80"/>
<area href="classmongo_1_1RecoveryUnitNoop.html" alt="mongo::RecoveryUnitNoop" shape="rect" coords="1088,56,1350,80"/>
<area href="classmongo_1_1WiredTigerRecoveryUnit.html" alt="mongo::WiredTigerRecoveryUnit" shape="rect" coords="1360,56,1622,80"/>
</map>
 </div></div>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> is responsible for ensuring that data is persisted. </p>
<p>All on-disk information must be mutated through this interface. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit_1_1Change.html">Change</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A <a class="el" href="classmongo_1_1RecoveryUnit_1_1Change.html" title="A Change is an action that is registerChange()&#39;d while a WriteUnitOfWork exists. ">Change</a> is an action that is <a class="el" href="classmongo_1_1RecoveryUnit.html#aa77394e746595779c6a0cf9dcb9333f6" title="The RecoveryUnit takes ownership of the change. ">registerChange()</a>'d while a <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> exists.  <a href="classmongo_1_1RecoveryUnit_1_1Change.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ab73d986cec10146d72945aa3a11b87a4"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">ReadSource</a> { <br />
&#160;&#160;<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4a47e15fc5e0417f4ddd368e536798a138">kUnset</a>, 
<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4ae1a6254f10b3e2f69d8885df80174e1d">kNoTimestamp</a>, 
<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4a783bd0f6356d0eaacedb2fa325e73cd8">kMajorityCommitted</a>, 
<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4a6ac3c436cd3a401e9f9b8d8c4853b5d7">kLastApplied</a>, 
<br />
&#160;&#160;<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4ab81b778c3f74a093f587f3d95a600c2e">kLastAppliedSnapshot</a>, 
<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4a6da9860a7e480d4d7f2cad14e29135e0">kProvided</a>
<br />
 }<tr class="memdesc:ab73d986cec10146d72945aa3a11b87a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ReadSource indicates which exteral or provided timestamp to read from for future transactions.  <a href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:ab73d986cec10146d72945aa3a11b87a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a78ccf94669747f5a9ebeab51fce73e0b"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a78ccf94669747f5a9ebeab51fce73e0b">~RecoveryUnit</a> ()</td></tr>
<tr class="separator:a78ccf94669747f5a9ebeab51fce73e0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bf744451000b79e20b1f641d4b8aaf6"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a6bf744451000b79e20b1f641d4b8aaf6">beginUnitOfWork</a> (OperationContext *<a class="el" href="namespacemongo.html#a15b23ef1d9a7f6cdadbf866f1e8e5043">opCtx</a>)=0</td></tr>
<tr class="memdesc:a6bf744451000b79e20b1f641d4b8aaf6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the beginning of a unit of work.  <a href="#a6bf744451000b79e20b1f641d4b8aaf6">More...</a><br /></td></tr>
<tr class="separator:a6bf744451000b79e20b1f641d4b8aaf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcdfa3cff074a147ca1d06fbdb84bef3"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#abcdfa3cff074a147ca1d06fbdb84bef3">commitUnitOfWork</a> ()=0</td></tr>
<tr class="memdesc:abcdfa3cff074a147ca1d06fbdb84bef3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the end of a unit of work and commits all changes registered by calls to onCommit or registerChange, in order.  <a href="#abcdfa3cff074a147ca1d06fbdb84bef3">More...</a><br /></td></tr>
<tr class="separator:abcdfa3cff074a147ca1d06fbdb84bef3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bfbaa2f28b9ebe0b7774443b0d84481"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a3bfbaa2f28b9ebe0b7774443b0d84481">abortUnitOfWork</a> ()=0</td></tr>
<tr class="memdesc:a3bfbaa2f28b9ebe0b7774443b0d84481"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the end of a unit of work and rolls back all changes registered by calls to onRollback or registerChange, in reverse order.  <a href="#a3bfbaa2f28b9ebe0b7774443b0d84481">More...</a><br /></td></tr>
<tr class="separator:a3bfbaa2f28b9ebe0b7774443b0d84481"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac93536b0d28f2e09e1dea494b427d135"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#ac93536b0d28f2e09e1dea494b427d135">prepareUnitOfWork</a> ()</td></tr>
<tr class="memdesc:ac93536b0d28f2e09e1dea494b427d135"><td class="mdescLeft">&#160;</td><td class="mdescRight">Transitions the active unit of work to the "prepared" state.  <a href="#ac93536b0d28f2e09e1dea494b427d135">More...</a><br /></td></tr>
<tr class="separator:ac93536b0d28f2e09e1dea494b427d135"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7de9852b198105e4448964bbd681a7"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a7b7de9852b198105e4448964bbd681a7">setIgnorePrepared</a> (bool ignore)</td></tr>
<tr class="memdesc:a7b7de9852b198105e4448964bbd681a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets whether or not to ignore prepared transactions if supported by this storage engine.  <a href="#a7b7de9852b198105e4448964bbd681a7">More...</a><br /></td></tr>
<tr class="separator:a7b7de9852b198105e4448964bbd681a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91074d53f8e4147977bfd90cd8ffa392"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a91074d53f8e4147977bfd90cd8ffa392">waitUntilDurable</a> ()=0</td></tr>
<tr class="memdesc:a91074d53f8e4147977bfd90cd8ffa392"><td class="mdescLeft">&#160;</td><td class="mdescRight">Waits until all commits that happened before this call are durable in the journal.  <a href="#a91074d53f8e4147977bfd90cd8ffa392">More...</a><br /></td></tr>
<tr class="separator:a91074d53f8e4147977bfd90cd8ffa392"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfbe972c6eb640ddf1660b37bd236888"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#adfbe972c6eb640ddf1660b37bd236888">waitUntilUnjournaledWritesDurable</a> ()</td></tr>
<tr class="memdesc:adfbe972c6eb640ddf1660b37bd236888"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlike <code>waitUntilDurable</code>, this method takes a stable checkpoint, making durable any writes on unjournaled tables that are behind the current stable timestamp.  <a href="#adfbe972c6eb640ddf1660b37bd236888">More...</a><br /></td></tr>
<tr class="separator:adfbe972c6eb640ddf1660b37bd236888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0b67bef4574ebe15bb418c658e2d1ac"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#ae0b67bef4574ebe15bb418c658e2d1ac">abandonSnapshot</a> ()=0</td></tr>
<tr class="memdesc:ae0b67bef4574ebe15bb418c658e2d1ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">If there is an open transaction, it is closed.  <a href="#ae0b67bef4574ebe15bb418c658e2d1ac">More...</a><br /></td></tr>
<tr class="separator:ae0b67bef4574ebe15bb418c658e2d1ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e155dd4639d64c3780a8e33b1229c2"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#ab7e155dd4639d64c3780a8e33b1229c2">preallocateSnapshot</a> ()</td></tr>
<tr class="memdesc:ab7e155dd4639d64c3780a8e33b1229c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Informs the <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> that a snapshot will be needed soon, if one was not already established.  <a href="#ab7e155dd4639d64c3780a8e33b1229c2">More...</a><br /></td></tr>
<tr class="separator:ab7e155dd4639d64c3780a8e33b1229c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa06eae806c652b8e9140a3e22c0f6d32"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#aa06eae806c652b8e9140a3e22c0f6d32">obtainMajorityCommittedSnapshot</a> ()</td></tr>
<tr class="memdesc:aa06eae806c652b8e9140a3e22c0f6d32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtains a majority committed snapshot.  <a href="#aa06eae806c652b8e9140a3e22c0f6d32">More...</a><br /></td></tr>
<tr class="separator:aa06eae806c652b8e9140a3e22c0f6d32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3eca651df7de7474ca04f9b58e605047"><td class="memItemLeft" align="right" valign="top">virtual boost::optional&lt; Timestamp &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a3eca651df7de7474ca04f9b58e605047">getPointInTimeReadTimestamp</a> () const</td></tr>
<tr class="memdesc:a3eca651df7de7474ca04f9b58e605047"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the Timestamp being used by this recovery unit or boost::none if not reading from a point in time.  <a href="#a3eca651df7de7474ca04f9b58e605047">More...</a><br /></td></tr>
<tr class="separator:a3eca651df7de7474ca04f9b58e605047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b67f3be8c7aeb40d76d68e1f061bef"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classmongo_1_1SnapshotId.html">SnapshotId</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a32b67f3be8c7aeb40d76d68e1f061bef">getSnapshotId</a> () const =0</td></tr>
<tr class="memdesc:a32b67f3be8c7aeb40d76d68e1f061bef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the local <a class="el" href="classmongo_1_1SnapshotId.html">SnapshotId</a>.  <a href="#a32b67f3be8c7aeb40d76d68e1f061bef">More...</a><br /></td></tr>
<tr class="separator:a32b67f3be8c7aeb40d76d68e1f061bef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a741651c20eba9f946bcf58908f780c"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c">setTimestamp</a> (Timestamp timestamp)</td></tr>
<tr class="memdesc:a2a741651c20eba9f946bcf58908f780c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a timestamp to assign to future writes in a transaction.  <a href="#a2a741651c20eba9f946bcf58908f780c">More...</a><br /></td></tr>
<tr class="separator:a2a741651c20eba9f946bcf58908f780c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7c1fe82af78f29a8d45c60b74682216"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#af7c1fe82af78f29a8d45c60b74682216">setCommitTimestamp</a> (Timestamp timestamp)</td></tr>
<tr class="memdesc:af7c1fe82af78f29a8d45c60b74682216"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a timestamp that will be assigned to all future writes on this <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> until <a class="el" href="classmongo_1_1RecoveryUnit.html#a2f4f847062bc4bef9f4478ff04f9c3e1">clearCommitTimestamp()</a> is called.  <a href="#af7c1fe82af78f29a8d45c60b74682216">More...</a><br /></td></tr>
<tr class="separator:af7c1fe82af78f29a8d45c60b74682216"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f4f847062bc4bef9f4478ff04f9c3e1"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a2f4f847062bc4bef9f4478ff04f9c3e1">clearCommitTimestamp</a> ()</td></tr>
<tr class="separator:a2f4f847062bc4bef9f4478ff04f9c3e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa109e1b7f241e111e955ad86ce5f0c1f"><td class="memItemLeft" align="right" valign="top">virtual Timestamp&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#aa109e1b7f241e111e955ad86ce5f0c1f">getCommitTimestamp</a> ()</td></tr>
<tr class="separator:aa109e1b7f241e111e955ad86ce5f0c1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05d80b9df7ebc42b4a31d215785cbff8"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a05d80b9df7ebc42b4a31d215785cbff8">setPrepareTimestamp</a> (Timestamp timestamp)</td></tr>
<tr class="memdesc:a05d80b9df7ebc42b4a31d215785cbff8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a prepare timestamp for the current transaction.  <a href="#a05d80b9df7ebc42b4a31d215785cbff8">More...</a><br /></td></tr>
<tr class="separator:a05d80b9df7ebc42b4a31d215785cbff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90a89e3d20bf1483f88a1db6e888c91b"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a90a89e3d20bf1483f88a1db6e888c91b">setTimestampReadSource</a> (<a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">ReadSource</a> source, boost::optional&lt; Timestamp &gt; provided=boost::none)</td></tr>
<tr class="memdesc:a90a89e3d20bf1483f88a1db6e888c91b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets which timestamp to use for read transactions.  <a href="#a90a89e3d20bf1483f88a1db6e888c91b">More...</a><br /></td></tr>
<tr class="separator:a90a89e3d20bf1483f88a1db6e888c91b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ca99643741926924e08d96ddcc2255"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">ReadSource</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#af9ca99643741926924e08d96ddcc2255">getTimestampReadSource</a> () const</td></tr>
<tr class="separator:af9ca99643741926924e08d96ddcc2255"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa77394e746595779c6a0cf9dcb9333f6"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#aa77394e746595779c6a0cf9dcb9333f6">registerChange</a> (<a class="el" href="classmongo_1_1RecoveryUnit_1_1Change.html">Change</a> *change)=0</td></tr>
<tr class="memdesc:aa77394e746595779c6a0cf9dcb9333f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> takes ownership of the change.  <a href="#aa77394e746595779c6a0cf9dcb9333f6">More...</a><br /></td></tr>
<tr class="separator:aa77394e746595779c6a0cf9dcb9333f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6327788abf54b8cb56fd92aff3e5212b"><td class="memTemplParams" colspan="2">template&lt;typename Callback &gt; </td></tr>
<tr class="memitem:a6327788abf54b8cb56fd92aff3e5212b"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a6327788abf54b8cb56fd92aff3e5212b">onRollback</a> (Callback callback)</td></tr>
<tr class="memdesc:a6327788abf54b8cb56fd92aff3e5212b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a callback to be called if the current <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> rolls back.  <a href="#a6327788abf54b8cb56fd92aff3e5212b">More...</a><br /></td></tr>
<tr class="separator:a6327788abf54b8cb56fd92aff3e5212b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23e39b3240412719df98678e9027a576"><td class="memTemplParams" colspan="2">template&lt;typename Callback &gt; </td></tr>
<tr class="memitem:a23e39b3240412719df98678e9027a576"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a23e39b3240412719df98678e9027a576">onCommit</a> (Callback callback)</td></tr>
<tr class="memdesc:a23e39b3240412719df98678e9027a576"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a callback to be called if the current <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> commits.  <a href="#a23e39b3240412719df98678e9027a576">More...</a><br /></td></tr>
<tr class="separator:a23e39b3240412719df98678e9027a576"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b23ef2f3a3a59eaee20ae616caca676"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a1b23ef2f3a3a59eaee20ae616caca676">writingPtr</a> (<a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> *<a class="el" href="ephemeral__for__test__record__store__test_8cpp.html#a7b0b6386ed9af4d133c80f6322cc60dc">data</a>, size_t len)=0</td></tr>
<tr class="memdesc:a1b23ef2f3a3a59eaee20ae616caca676"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare that the data at [x, x + len) is being written.  <a href="#a1b23ef2f3a3a59eaee20ae616caca676">More...</a><br /></td></tr>
<tr class="separator:a1b23ef2f3a3a59eaee20ae616caca676"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56e0890e1bdbde55db22f0a9c6b66d07"><td class="memItemLeft" align="right" valign="top">int &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a56e0890e1bdbde55db22f0a9c6b66d07">writingInt</a> (int &amp;d)</td></tr>
<tr class="memdesc:a56e0890e1bdbde55db22f0a9c6b66d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare write intent for an int.  <a href="#a56e0890e1bdbde55db22f0a9c6b66d07">More...</a><br /></td></tr>
<tr class="separator:a56e0890e1bdbde55db22f0a9c6b66d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6115a1b56fb07dba55a1b46df9ab755"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ac6115a1b56fb07dba55a1b46df9ab755"><td class="memTemplItemLeft" align="right" valign="top">T *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#ac6115a1b56fb07dba55a1b46df9ab755">writing</a> (T *x)</td></tr>
<tr class="memdesc:ac6115a1b56fb07dba55a1b46df9ab755"><td class="mdescLeft">&#160;</td><td class="mdescRight">A templated helper for writingPtr.  <a href="#ac6115a1b56fb07dba55a1b46df9ab755">More...</a><br /></td></tr>
<tr class="separator:ac6115a1b56fb07dba55a1b46df9ab755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91ccb0edb38fa25858e7b7a5a509fb93"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a91ccb0edb38fa25858e7b7a5a509fb93">setRollbackWritesDisabled</a> ()=0</td></tr>
<tr class="memdesc:a91ccb0edb38fa25858e7b7a5a509fb93"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets a flag that declares this <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> will skip rolling back writes, for the duration of the current outermost <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a>.  <a href="#a91ccb0edb38fa25858e7b7a5a509fb93">More...</a><br /></td></tr>
<tr class="separator:a91ccb0edb38fa25858e7b7a5a509fb93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24196b6876e437df39cfb41757ad1b6b"><td class="memItemLeft" align="right" valign="top">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a24196b6876e437df39cfb41757ad1b6b">setOrderedCommit</a> (bool orderedCommit)=0</td></tr>
<tr class="separator:a24196b6876e437df39cfb41757ad1b6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a884f48e4987b3543709aaf5e53b914a2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a884f48e4987b3543709aaf5e53b914a2">RecoveryUnit</a> ()</td></tr>
<tr class="separator:a884f48e4987b3543709aaf5e53b914a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a2eb92394347d62595776a81f14544feb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1RecoveryUnit.html#a2eb92394347d62595776a81f14544feb">MONGO_DISALLOW_COPYING</a> (<a class="el" href="classmongo_1_1RecoveryUnit.html">RecoveryUnit</a>)</td></tr>
<tr class="separator:a2eb92394347d62595776a81f14544feb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="ab73d986cec10146d72945aa3a11b87a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab73d986cec10146d72945aa3a11b87a4">&#9670;&nbsp;</a></span>ReadSource</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">mongo::RecoveryUnit::ReadSource</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ReadSource indicates which exteral or provided timestamp to read from for future transactions. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4a47e15fc5e0417f4ddd368e536798a138"></a>kUnset&#160;</td><td class="fielddoc"><p>Do not read from a timestamp. </p>
<p>This is the default. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4ae1a6254f10b3e2f69d8885df80174e1d"></a>kNoTimestamp&#160;</td><td class="fielddoc"><p>Read without a timestamp explicitly. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4a783bd0f6356d0eaacedb2fa325e73cd8"></a>kMajorityCommitted&#160;</td><td class="fielddoc"><p>Read from the majority all-commmitted timestamp. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4a6ac3c436cd3a401e9f9b8d8c4853b5d7"></a>kLastApplied&#160;</td><td class="fielddoc"><p>Read from the last applied timestamp. </p>
<p>New transactions start at the most up-to-date timestamp. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4ab81b778c3f74a093f587f3d95a600c2e"></a>kLastAppliedSnapshot&#160;</td><td class="fielddoc"><p>Read from the last applied timestamp. </p>
<p>New transactions will always read from the same timestamp and never advance. </p>
</td></tr>
<tr><td class="fieldname"><a id="ab73d986cec10146d72945aa3a11b87a4a6da9860a7e480d4d7f2cad14e29135e0"></a>kProvided&#160;</td><td class="fielddoc"><p>Read from the timestamp provided to setTimestampReadSource. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a78ccf94669747f5a9ebeab51fce73e0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78ccf94669747f5a9ebeab51fce73e0b">&#9670;&nbsp;</a></span>~RecoveryUnit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual mongo::RecoveryUnit::~RecoveryUnit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a884f48e4987b3543709aaf5e53b914a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a884f48e4987b3543709aaf5e53b914a2">&#9670;&nbsp;</a></span>RecoveryUnit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">mongo::RecoveryUnit::RecoveryUnit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae0b67bef4574ebe15bb418c658e2d1ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0b67bef4574ebe15bb418c658e2d1ac">&#9670;&nbsp;</a></span>abandonSnapshot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::abandonSnapshot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If there is an open transaction, it is closed. </p>
<p>On return no transaction is active. This cannot be called inside of a <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a>, and should fail if it is. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#ab6336bd1c36ebf3eb0bd6a80f665f3c6">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a353c84a389485429c0ea5d53838f3c53">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a624edccf7c4e4124de731857ebab56a5">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a1aaca044c1352fe20cd550b9d2e7d770">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a328e24c16dadd6a2c1b1f081169c1ba7">mongo::EphemeralForTestRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a965addc983f1f2caa2ea4d952629cbd9">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<a id="a3bfbaa2f28b9ebe0b7774443b0d84481"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bfbaa2f28b9ebe0b7774443b0d84481">&#9670;&nbsp;</a></span>abortUnitOfWork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::abortUnitOfWork </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Marks the end of a unit of work and rolls back all changes registered by calls to onRollback or registerChange, in reverse order. </p>
<p>Must be matched by exactly one preceding call to beginUnitOfWork.</p>
<p>Should be called through <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> rather than directly. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#a0eff18f8ed55202484df1604059067b1">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#ae831349512301e7bb2fac04dccc3ec1e">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a75bcc77a13da3cb9fed3949007958a2f">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#ad24c8bea7cd804784d2b515e46883d47">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a567d229a6eb407eaa8df60822a942d26">mongo::DurRecoveryUnit</a>, and <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a067626ccdb58907e60151950899b4141">mongo::EphemeralForTestRecoveryUnit</a>.</p>

</div>
</div>
<a id="a6bf744451000b79e20b1f641d4b8aaf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bf744451000b79e20b1f641d4b8aaf6">&#9670;&nbsp;</a></span>beginUnitOfWork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::beginUnitOfWork </td>
          <td>(</td>
          <td class="paramtype">OperationContext *&#160;</td>
          <td class="paramname"><em>opCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Marks the beginning of a unit of work. </p>
<p>Each call must be matched with exactly one call to either commitUnitOfWork or abortUnitOfWork.</p>
<p>Should be called through <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> rather than directly. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#acfa9dc90cac1e55fc90f66ba5ce91fb7">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a6aa3e5517cd732e450d5e190d8c1c83d">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a99058e6c8eedb141e8e3c9a32345f2d0">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a4a5034fbe4070d04f2cf528d1da49647">mongo::DurRecoveryUnit</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#acc6a37cfed7d5656a82236013ea282b6">mongo::EphemeralForTestRecoveryUnit</a>, and <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a794d7b224bf0a238f416125773f774b6">mongo::RecoveryUnitNoop</a>.</p>

</div>
</div>
<a id="a2f4f847062bc4bef9f4478ff04f9c3e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f4f847062bc4bef9f4478ff04f9c3e1">&#9670;&nbsp;</a></span>clearCommitTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::clearCommitTimestamp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a756e66cb6185adcb277bc18a126ba760">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="abcdfa3cff074a147ca1d06fbdb84bef3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcdfa3cff074a147ca1d06fbdb84bef3">&#9670;&nbsp;</a></span>commitUnitOfWork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::commitUnitOfWork </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Marks the end of a unit of work and commits all changes registered by calls to onCommit or registerChange, in order. </p>
<p>Must be matched by exactly one preceding call to beginUnitOfWork.</p>
<p>Should be called through <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> rather than directly. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#a566945213dbeaa99ece68b528e3ecc98">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#afd4bddc5cfe4419930b697f063f5e29e">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a544cddc4eff8e6731a5682bb7037a97d">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1DurRecoveryUnit.html#ab3d2b192a62d09c423245a1758edf431">mongo::DurRecoveryUnit</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#aa28d27065253738568b488785f7d7680">mongo::EphemeralForTestRecoveryUnit</a>, and <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a83f843dd6d45f90f3da74540939ee6b2">mongo::RecoveryUnitNoop</a>.</p>

</div>
</div>
<a id="aa109e1b7f241e111e955ad86ce5f0c1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa109e1b7f241e111e955ad86ce5f0c1f">&#9670;&nbsp;</a></span>getCommitTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual Timestamp mongo::RecoveryUnit::getCommitTimestamp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#aff46ab5936cdb67bbfde88e1d0d58941">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a3eca651df7de7474ca04f9b58e605047"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3eca651df7de7474ca04f9b58e605047">&#9670;&nbsp;</a></span>getPointInTimeReadTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual boost::optional&lt;Timestamp&gt; mongo::RecoveryUnit::getPointInTimeReadTimestamp </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the Timestamp being used by this recovery unit or boost::none if not reading from a point in time. </p>
<p>Any point in time returned will reflect one of the following:</p><ul>
<li>when using ReadSource::kProvided, the timestamp provided.</li>
<li>when using ReadSource::kLastAppliedSnapshot, the timestamp chosen using the storage engine's last applied timestamp.</li>
<li>when using ReadSource::kLastApplied, the last applied timestamp at which the current storage transaction was opened, if one is open.</li>
<li>when using ReadSource::kMajorityCommitted, the majority committed timestamp chosen by the storage engine after a transaction has been opened or after a call to <a class="el" href="classmongo_1_1RecoveryUnit.html#aa06eae806c652b8e9140a3e22c0f6d32" title="Obtains a majority committed snapshot. ">obtainMajorityCommittedSnapshot()</a>. </li>
</ul>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a6e38a71b91c0c6071e211b8210d315ef">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a32b67f3be8c7aeb40d76d68e1f061bef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32b67f3be8c7aeb40d76d68e1f061bef">&#9670;&nbsp;</a></span>getSnapshotId()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classmongo_1_1SnapshotId.html">SnapshotId</a> mongo::RecoveryUnit::getSnapshotId </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the local <a class="el" href="classmongo_1_1SnapshotId.html">SnapshotId</a>. </p>
<p>It is only valid to compare SnapshotIds generated by a single <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a>.</p>
<p>This is unrelated to Timestamp which must be globally comparable. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#afd3330cd87ff83aa8a2a13e6d5b2e51c">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a5d6d76e5ece99df89239f40b5a6e7200">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a031ed9d2ddecb9430718d14505bc4a6c">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a04a4b03e55d8cfda4186ecac3dfb578b">mongo::EphemeralForTestRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a651a95e7222690dbd05a98b7f8dbe3dd">mongo::MobileRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#aa3b23bfb5b9546cf1368dbac620d4602">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<a id="af9ca99643741926924e08d96ddcc2255"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9ca99643741926924e08d96ddcc2255">&#9670;&nbsp;</a></span>getTimestampReadSource()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">ReadSource</a> mongo::RecoveryUnit::getTimestampReadSource </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a070d53199e5e8e2fcff085e4731da924">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a2eb92394347d62595776a81f14544feb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eb92394347d62595776a81f14544feb">&#9670;&nbsp;</a></span>MONGO_DISALLOW_COPYING()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">mongo::RecoveryUnit::MONGO_DISALLOW_COPYING </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmongo_1_1RecoveryUnit.html">RecoveryUnit</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa06eae806c652b8e9140a3e22c0f6d32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa06eae806c652b8e9140a3e22c0f6d32">&#9670;&nbsp;</a></span>obtainMajorityCommittedSnapshot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a> mongo::RecoveryUnit::obtainMajorityCommittedSnapshot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Obtains a majority committed snapshot. </p>
<p>Snapshots should still be separately acquired and newer committed snapshots should be used if available whenever implementations would normally change snapshots.</p>
<p>If no snapshot has yet been marked as Majority Committed, returns a status with error code ReadConcernMajorityNotAvailableYet. After this returns successfully, at any point where implementations attempt to acquire committed snapshot, if there are none available due to a call to <a class="el" href="classmongo_1_1SnapshotManager.html#a38694aef860d6144397c165e0a9f387a" title="Drops all snapshots and clears the &quot;committed&quot; snapshot. ">SnapshotManager::dropAllSnapshots()</a>, a AssertionException with the same code should be thrown.</p>
<p>StorageEngines that don't support a <a class="el" href="classmongo_1_1SnapshotManager.html" title="Manages snapshots that can be read from at a later time. ">SnapshotManager</a> should use the default implementation. </p>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#ac7fd71ce2c245937672ca499f3361bf9">mongo::WiredTigerRecoveryUnit</a>, and <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a85aa493fa7fede7e117d92b40e5f2ada">mongo::EphemeralForTestRecoveryUnit</a>.</p>

</div>
</div>
<a id="a23e39b3240412719df98678e9027a576"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23e39b3240412719df98678e9027a576">&#9670;&nbsp;</a></span>onCommit()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callback &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::onCommit </td>
          <td>(</td>
          <td class="paramtype">Callback&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Registers a callback to be called if the current <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> commits. </p>
<p>Be careful about the lifetimes of all variables captured by the callback! </p>

</div>
</div>
<a id="a6327788abf54b8cb56fd92aff3e5212b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6327788abf54b8cb56fd92aff3e5212b">&#9670;&nbsp;</a></span>onRollback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Callback &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::onRollback </td>
          <td>(</td>
          <td class="paramtype">Callback&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Registers a callback to be called if the current <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> rolls back. </p>
<p>Be careful about the lifetimes of all variables captured by the callback! </p>

</div>
</div>
<a id="ab7e155dd4639d64c3780a8e33b1229c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7e155dd4639d64c3780a8e33b1229c2">&#9670;&nbsp;</a></span>preallocateSnapshot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::preallocateSnapshot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Informs the <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> that a snapshot will be needed soon, if one was not already established. </p>
<p>This specifically allows the storage engine to preallocate any required transaction resources while minimizing the critical section between generating a new timestamp and setting it using setTimestamp. </p>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a64848ff935df6fbe8326bcd8043c28b9">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="ac93536b0d28f2e09e1dea494b427d135"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac93536b0d28f2e09e1dea494b427d135">&#9670;&nbsp;</a></span>prepareUnitOfWork()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::prepareUnitOfWork </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Transitions the active unit of work to the "prepared" state. </p>
<p>Must be called after beginUnitOfWork and before calling either abortUnitOfWork or commitUnitOfWork. Must be overridden by storage engines that support prepared transactions.</p>
<p>Must be preceded by a call to beginUnitOfWork and setPrepareTimestamp, in that order.</p>
<p>This cannot be called after setTimestamp or setCommitTimestamp. </p>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#ad8aaeea1b96eeb03055026479be9efb9">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="aa77394e746595779c6a0cf9dcb9333f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa77394e746595779c6a0cf9dcb9333f6">&#9670;&nbsp;</a></span>registerChange()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::registerChange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmongo_1_1RecoveryUnit_1_1Change.html">Change</a> *&#160;</td>
          <td class="paramname"><em>change</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> takes ownership of the change. </p>
<p>The <a class="el" href="classmongo_1_1RecoveryUnit.html#abcdfa3cff074a147ca1d06fbdb84bef3" title="Marks the end of a unit of work and commits all changes registered by calls to onCommit or registerCh...">commitUnitOfWork()</a> method calls the commit() method of each registered change in order of registration. The endUnitOfWork() method calls the rollback() method of each registered <a class="el" href="classmongo_1_1RecoveryUnit_1_1Change.html" title="A Change is an action that is registerChange()&#39;d while a WriteUnitOfWork exists. ">Change</a> in reverse order of registration. Either will unregister and delete the changes.</p>
<p>The <a class="el" href="classmongo_1_1RecoveryUnit.html#aa77394e746595779c6a0cf9dcb9333f6" title="The RecoveryUnit takes ownership of the change. ">registerChange()</a> method may only be called when a <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a> is active, and may not be called during commit or rollback. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#a525ac8a1c47dc74749b81f63bc684148">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#ab5e341f75dd950365b8120901400b891">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a9c75247ff4d82527d9ed9818eca68dd3">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a945028090dfe57ed39d6fc442da7aaa1">mongo::EphemeralForTestRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a599d10d6e22e415d892956470949374e">mongo::MobileRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a67f3a8da5b83935f1004c050e44d71cb">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<a id="af7c1fe82af78f29a8d45c60b74682216"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7c1fe82af78f29a8d45c60b74682216">&#9670;&nbsp;</a></span>setCommitTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setCommitTimestamp </td>
          <td>(</td>
          <td class="paramtype">Timestamp&#160;</td>
          <td class="paramname"><em>timestamp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets a timestamp that will be assigned to all future writes on this <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> until <a class="el" href="classmongo_1_1RecoveryUnit.html#a2f4f847062bc4bef9f4478ff04f9c3e1">clearCommitTimestamp()</a> is called. </p>
<p>This must be called outside of a WUOW and <a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c" title="Sets a timestamp to assign to future writes in a transaction. ">setTimestamp()</a> must not be called while a commit timestamp is set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">timestamp</td><td>Timestamp to assign to future writes in a transaction </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a9877712fa723af73baae6c3f3d2ea1d1">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a7b7de9852b198105e4448964bbd681a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7de9852b198105e4448964bbd681a7">&#9670;&nbsp;</a></span>setIgnorePrepared()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setIgnorePrepared </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>ignore</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets whether or not to ignore prepared transactions if supported by this storage engine. </p>
<p>When 'ignore' is true, allows reading data in prepared, but uncommitted transactions. </p>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a3027f7688eb324a651b0b3481caaa10d">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a24196b6876e437df39cfb41757ad1b6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24196b6876e437df39cfb41757ad1b6b">&#9670;&nbsp;</a></span>setOrderedCommit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setOrderedCommit </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>orderedCommit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#a48b681fd6d4e46077d8002eeb4c67a83">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#adb0a5fb076cb3fd9f2315bf75b109482">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#aa1118c67eb257d5299d742e25858a9ed">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#ac722e5f5b26cb72f88cdc847ba520f90">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#ac06481f97833afb6cb68a8786061ba81">mongo::EphemeralForTestRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a597642797666e92e737fa5b09ed40ebc">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<a id="a05d80b9df7ebc42b4a31d215785cbff8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05d80b9df7ebc42b4a31d215785cbff8">&#9670;&nbsp;</a></span>setPrepareTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setPrepareTimestamp </td>
          <td>(</td>
          <td class="paramtype">Timestamp&#160;</td>
          <td class="paramname"><em>timestamp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets a prepare timestamp for the current transaction. </p>
<p>A subsequent call to <a class="el" href="classmongo_1_1RecoveryUnit.html#ac93536b0d28f2e09e1dea494b427d135" title="Transitions the active unit of work to the &quot;prepared&quot; state. ">prepareUnitOfWork()</a> is expected and required. This cannot be called after setTimestamp or setCommitTimestamp. This must be called inside a WUOW and may only be called once.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">timestamp</td><td>Timestamp to use when calling prepareUnitOfWork </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a21554e970baff26792aa20151de253ee">mongo::WiredTigerRecoveryUnit</a>, and <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a1228a99f7ebea4b7c46c7c91e822cc97">mongo::EphemeralForTestRecoveryUnit</a>.</p>

</div>
</div>
<a id="a91ccb0edb38fa25858e7b7a5a509fb93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91ccb0edb38fa25858e7b7a5a509fb93">&#9670;&nbsp;</a></span>setRollbackWritesDisabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setRollbackWritesDisabled </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets a flag that declares this <a class="el" href="classmongo_1_1RecoveryUnit.html" title="A RecoveryUnit is responsible for ensuring that data is persisted. ">RecoveryUnit</a> will skip rolling back writes, for the duration of the current outermost <a class="el" href="classmongo_1_1WriteUnitOfWork.html" title="The WriteUnitOfWork is an RAII type that begins a storage engine write unit of work on both the Locke...">WriteUnitOfWork</a>. </p>
<p>This function can only be called between a pair of unnested <a class="el" href="classmongo_1_1RecoveryUnit.html#a6bf744451000b79e20b1f641d4b8aaf6" title="Marks the beginning of a unit of work. ">beginUnitOfWork()</a> / endUnitOfWork() calls. The flag is cleared when endUnitOfWork() is called. While the flag is set, rollback will skip rolling back writes, but custom rollback change functions are still called. Clearly, this functionality should only be used when writing to temporary collections that can be cleaned up externally. For example, foreground index builds write to a temporary collection; if something goes wrong that normally requires a rollback, we can instead clean up the index by dropping the entire index. Setting the flag may permit increased performance. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#ad19ae3818b6f738093cc90f9a23b2b5c">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#aa834f4acfe938c6bf6777f380e63e459">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a6d7791eed25c518dfb15719caeee213d">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a26943c7111172e1b7b10c7e12c7d5573">mongo::EphemeralForTestRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#acddbe1739767830028d791db121299bd">mongo::MobileRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#af29cfc676f1948a886b818b387dd1dc4">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<a id="a2a741651c20eba9f946bcf58908f780c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a741651c20eba9f946bcf58908f780c">&#9670;&nbsp;</a></span>setTimestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#ac22dc5094e8aebfd46494f3960afbcc3">Status</a> mongo::RecoveryUnit::setTimestamp </td>
          <td>(</td>
          <td class="paramtype">Timestamp&#160;</td>
          <td class="paramname"><em>timestamp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets a timestamp to assign to future writes in a transaction. </p>
<p>All subsequent writes will be assigned this timestamp. If <a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c" title="Sets a timestamp to assign to future writes in a transaction. ">setTimestamp()</a> is called again, specifying a new timestamp, future writes will use this new timestamp but past writes remain with their originally assigned timestamps. Writes that occur before any <a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c" title="Sets a timestamp to assign to future writes in a transaction. ">setTimestamp()</a> is called will be assigned the timestamp specified in the last <a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c" title="Sets a timestamp to assign to future writes in a transaction. ">setTimestamp()</a> call in the transaction, at commit time.</p>
<p><a class="el" href="classmongo_1_1RecoveryUnit.html#a2a741651c20eba9f946bcf58908f780c" title="Sets a timestamp to assign to future writes in a transaction. ">setTimestamp()</a> will fail if a commit timestamp is set using <a class="el" href="classmongo_1_1RecoveryUnit.html#af7c1fe82af78f29a8d45c60b74682216" title="Sets a timestamp that will be assigned to all future writes on this RecoveryUnit until clearCommitTim...">setCommitTimestamp()</a> and not yet cleared with <a class="el" href="classmongo_1_1RecoveryUnit.html#a2f4f847062bc4bef9f4478ff04f9c3e1">clearCommitTimestamp()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">timestamp</td><td>Timestamp to assign to future writes in a transaction </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#ac3d4b9701e9b43cf39ff651c0c338ff0">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a90a89e3d20bf1483f88a1db6e888c91b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a89e3d20bf1483f88a1db6e888c91b">&#9670;&nbsp;</a></span>setTimestampReadSource()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> mongo::RecoveryUnit::setTimestampReadSource </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmongo_1_1RecoveryUnit.html#ab73d986cec10146d72945aa3a11b87a4">ReadSource</a>&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::optional&lt; Timestamp &gt;&#160;</td>
          <td class="paramname"><em>provided</em> = <code>boost::none</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets which timestamp to use for read transactions. </p>
<p>If 'provided' is supplied, only kProvided is an acceptable input.</p>
<p>Must be called in one of the following cases:</p><ul>
<li>a transaction is not active</li>
<li>no read source has been set yet</li>
<li>the read source provided is the same as the existing read source </li>
</ul>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a93d355268ab9f6c5460cf850d81caed9">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="a91074d53f8e4147977bfd90cd8ffa392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91074d53f8e4147977bfd90cd8ffa392">&#9670;&nbsp;</a></span>waitUntilDurable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool mongo::RecoveryUnit::waitUntilDurable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Waits until all commits that happened before this call are durable in the journal. </p>
<p>Returns true, unless the storage engine cannot guarantee durability, which should never happen when isDurable() returned true. This cannot be called from inside a unit of work, and should fail if it is.</p>
<dl class="section return"><dt>Returns</dt><dd>Whether or not the storage engine can guarantee durability. </dd></dl>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#aeb4b1e2a801522ce434ae1182eaaf56e">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a2945e8ac870a09b0a435cefa1fae33ef">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#a6647a644d8c8f013ca2f63de530e273c">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#abad0226205e2b124c0d43ebffc402364">mongo::MobileRecoveryUnit</a>, <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a2033db6bf8076b07f4fa6328b4f4b5b5">mongo::DurRecoveryUnit</a>, and <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#ae31d0b26d91130d299d4c7a1c47ad95f">mongo::EphemeralForTestRecoveryUnit</a>.</p>

</div>
</div>
<a id="adfbe972c6eb640ddf1660b37bd236888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfbe972c6eb640ddf1660b37bd236888">&#9670;&nbsp;</a></span>waitUntilUnjournaledWritesDurable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual bool mongo::RecoveryUnit::waitUntilUnjournaledWritesDurable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unlike <code>waitUntilDurable</code>, this method takes a stable checkpoint, making durable any writes on unjournaled tables that are behind the current stable timestamp. </p>
<p>If the storage engine is starting from an "unstable" checkpoint, this method call will turn into an unstable checkpoint.</p>
<p>This must not be called by a system taking user writes until after a stable timestamp is passed to the storage engine.</p>
<dl class="section return"><dt>Returns</dt><dd>Whether or not the storage engine can guarantee durability. </dd></dl>

<p>Reimplemented in <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a99c386a08eab70681a430d70faafda2e">mongo::WiredTigerRecoveryUnit</a>.</p>

</div>
</div>
<a id="ac6115a1b56fb07dba55a1b46df9ab755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6115a1b56fb07dba55a1b46df9ab755">&#9670;&nbsp;</a></span>writing()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">T* mongo::RecoveryUnit::writing </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>x</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A templated helper for writingPtr. </p>

</div>
</div>
<a id="a56e0890e1bdbde55db22f0a9c6b66d07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56e0890e1bdbde55db22f0a9c6b66d07">&#9670;&nbsp;</a></span>writingInt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int&amp; mongo::RecoveryUnit::writingInt </td>
          <td>(</td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Declare write intent for an int. </p>

</div>
</div>
<a id="a1b23ef2f3a3a59eaee20ae616caca676"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b23ef2f3a3a59eaee20ae616caca676">&#9670;&nbsp;</a></span>writingPtr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual <a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a>* mongo::RecoveryUnit::writingPtr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacemongo.html#aa639063deea016a1dac8f046e93900a6">void</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Declare that the data at [x, x + len) is being written. </p>

<p>Implemented in <a class="el" href="classmongo_1_1HeapRecordStoreBtreeRecoveryUnit.html#a42109c714134ba40a448efcf7014f272">mongo::HeapRecordStoreBtreeRecoveryUnit</a>, <a class="el" href="classmongo_1_1WiredTigerRecoveryUnit.html#a7991171790cd5c4c681fdd06c5fd9c22">mongo::WiredTigerRecoveryUnit</a>, <a class="el" href="classmongo_1_1RecoveryUnitNoop.html#aac2d0ea4f319b3da66a550aedcdb451c">mongo::RecoveryUnitNoop</a>, <a class="el" href="classmongo_1_1EphemeralForTestRecoveryUnit.html#a0ac6527526ee35b583365f5c888e905a">mongo::EphemeralForTestRecoveryUnit</a>, <a class="el" href="classmongo_1_1MobileRecoveryUnit.html#a4aab70f9c6198a293c8dce0079f91029">mongo::MobileRecoveryUnit</a>, and <a class="el" href="classmongo_1_1DurRecoveryUnit.html#a70a85a2c23f804b28b75460eb3a28a7c">mongo::DurRecoveryUnit</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/louis/git/mongodbsource.github.io/src/src/mongo/db/storage/<a class="el" href="recovery__unit_8h_source.html">recovery_unit.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemongo.html">mongo</a></li><li class="navelem"><a class="el" href="classmongo_1_1RecoveryUnit.html">RecoveryUnit</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
